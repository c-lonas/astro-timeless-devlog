---
import Filter from "./Filter.astro";
const allPosts = await Astro.glob('../pages/posts/*.md');
---

<!--Parent Div -->

<div x-data="{ isCollapsed: false }" class=" relative">

    <!--Transition Color Drag Effect -->
    <div
        class=" fixed left-2 top-16 h-screen cursor-pointer bg-gradient-to-t from-dark-gold to-light-gold blur hover:blur-md transition-all z-30"
        :class=" isCollapsed ? 'w-6 bg-transparent duration-600 opacity-40 hover:opacity-50' : 'w-64 xl:w-72 duration-500 opacity-20 hover:opacity-30' "
        @click="isCollapsed = !isCollapsed" 
        
    ></div>
    
    <!-- Click helper for draft effect -->
    <div
        class=" fixed top-16 h-screen w-14 cursor-pointer z-50"
        :class=" isCollapsed ? 'left-0' : 'left-60 xl:left-68 ' "
        @click="isCollapsed = !isCollapsed" 
    ></div>

        <!-- Sidebar -->
        <div
            :class="isCollapsed ? 'w-6 bg-neutral-800 opacity-85 rounded-r-xl duration-500 scrollbar-none pointer-events-none' : 'w-64 xl:w-72 duration-600'"
            class="fixed left-0 top-16 h-screen border-r bg-neutral-900 border-neutral-600 scrollbar-thin overflow-y-scroll transition-all z-40"
        >
        
            <!-- Content Here -->
            <div x-show="!isCollapsed">
            <Filter />
    
            </div>
            <ul
                x-show="!isCollapsed"
                id="posts-list"
                class="p-4"
                data-posts={JSON.stringify(allPosts.reverse().map(post => ({
                    url: post.url,
                    title: post.frontmatter.title,
                    category: post.frontmatter.category
                })))}
            >

            </ul>

            <!-- <div class="h-24"></div> -->
        </div>
    

    <!-- Collapse Button -->
    <!-- <button
        @click="isCollapsed = !isCollapsed"
        :class="{ 'left-4 -rotate-90': isCollapsed, 'left-64 xl:left-72 rotate-90': !isCollapsed }"
        class="fixed w-6 h-6 top-96 shadow-sm transition-all duration-500 rounded-full text-white cursor-pointer z-10 "
        
    >
        <img src="/src/assets/images/common/symbols/caret-down-cyan-600.png">
    </button> -->
</div>





<script type="module">
    function renderPosts(posts) {
        const postsList = document.getElementById('posts-list');
        postsList.innerHTML = '';
        posts.forEach(post => {
            const anchor = document.createElement('a');
            anchor.href = post.url;

            const listItem = document.createElement('li');
            listItem.className = 'fade-in group pl-4 pb-4'; 

            const paragraph = document.createElement('p');
            paragraph.className = "transition-transform ease-in-out duration-300 group-hover:translate-x-[-5px] group-hover:text-cyan-600 group-hover:text-glow-sm";
            paragraph.textContent = post.title;

            listItem.appendChild(paragraph);
            anchor.appendChild(listItem);
            postsList.appendChild(anchor);
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
      const postsList = document.getElementById('posts-list');
      const postsData = JSON.parse(postsList.dataset.posts);

      renderPosts(postsData);

      document.addEventListener('categoryChanged', (event) => {
        const selectedCategory = event.detail;
        const postsData = JSON.parse(document.getElementById('posts-list').dataset.posts);
        const postsList = document.getElementById('posts-list');

        const filteredPosts = selectedCategory === 'all'
            ? postsData
            : postsData.filter(post => post.category.includes(selectedCategory.toLowerCase()));

        renderPosts(filteredPosts);
      });
      
      // Initial filter for 'All' selected
      document.dispatchEvent(new CustomEvent('categoryChange', { detail: '' }));
    });
</script>


<!-- Alpine Collapse Plugin -->
<!-- <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script> -->
